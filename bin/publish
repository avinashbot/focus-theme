#!/usr/bin/env ruby
# frozen_string_literal: true

# Ask immediately to avoid "lag"
print 'Describe your changes: '
reason = gets.chomp

require 'bundler/setup'
require 'dotenv'
require 'redd'
require 'sass'

Dotenv.load

css = Sass::Engine.for_file(File.join(__dir__, '../theme/main.scss'), {}).render
subreddit = Redd.it(
  user_agent: 'Redd:Theme Publisher:v0.1.0 (by /u/Mustermind)',
  client_id: ENV.fetch('CLIENT_ID'),
  secret: ENV.fetch('SECRET'),
  username: ENV.fetch('USERNAME'),
  password: ENV.fetch('PASSWORD')
).subreddit(ENV.fetch('SUBREDDIT'))

subreddit.update_stylesheet(css, reason: reason)
